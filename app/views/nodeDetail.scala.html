@(networks: List[models.DataBase.Network], nodes: List[models.DataBase.Node], initTimes: List[models.DataBase.InitTime])

@main("Welcome Vivaldi Monitor"){

    <div class="row full-width">
        <div class="large-3 columns sidebar">
            <div class="row">
                <dl class="sub-nav">
                    <dt>Graph:</dt>
                    <dd><a href="./">Node Map</a></dd>
                    <dd class="active"><a href="#">Node Detail</a></dd>
                </dl>
            </div>
            <div class="row">
                <div class="large-12 columns">
                    <form id="coordinateParamForm">
                        <div class="row">
                            <div class="large-12 columns">
                                <label>Network : <i id="networkLock"></i></label>
                                <select name="network" id="networkSelect">
                                @for(network <- networks){
                                    <option value="@network.id">@network.networkName</option>
                                }
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="large-12 columns">
                                <label>Node :  <i id="nodeLock"></i></label>
                                <select name="node" id="nodeSelect">
                                @for(node <- nodes){
                                    <option value="@node.id">@node.nodeName</option>
                                }
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="large-12 columns">
                                <label>Initialization Time :</label>
                                <select name="initTime" id="initTimeSelect">
                                @for(initTime <- initTimes){
                                    <option value="@initTime.id">@initTime.initTime.toString("dd-MM-yyyy HH:mm:ss")</option>
                                }
                                </select>
                            </div>
                        </div>
                        <ul class="button-group radius">
                            <li><a class="button" onclick="triggerGraphs()">Generate</a></li>
                            <li><a class="button" id="refreshButton" onclick="toggleRefresh(triggerGraphs); toggleSelectfields();" ><i id="fi-refresh" class="refreshB fi-refresh"></i></a></li>
                        </ul>
                    </form>
                </div>
            </div>
        </div>
        <div class="large-9 columns">
            <div class="row nodeGraphHolder">
                <div class="large-12 columns">
                    <div id="Xchart_div">

                    </div>
                </div>
            </div>
            <div class="row nodeGraphHolder">
                <div class="large-12 columns">
                    <div id="Ychart_div">

                    </div>
                </div>
            </div>

            <div class="row nodeGraphHolder">
                <div class="large-12 columns">
                    <div id="bubbleChart_div">

                    </div>
                </div>
            </div>

            <div class="row nodeGraphHolder">
                <div class="large-12 columns">
                    <div id="cumulChart_div">

                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>

        /* ==============================================================================
                                        Navigation update
           ============================================================================== */

        $("select[name=network]").change(function(){
            var nodeList = $("select[name=node");

            $.ajax({
                url: location.protocol+"//"+window.location.host+"/networks/"+getSelectedId("network")+"/nodes",
                accepts: "application/json",
                error: function( jqXHR, textStatus, errorThrown ){
                    showError(jqXHR , textStatus, errorThrown);
                },
                success:  function( data ){
                    nodeList.empty()
                    for (var i = 0 ; i < data.length ; i++){
                        nodeList.append('<option value="'+data[i].id+'">'+data[i ].nodeName+'</option>');
                    }
                    updateInitTimesList()
                }
            });
        });

        $("select[name=node]" ).change(function(){
            updateInitTimesList();
        });

        function updateInitTimesList(){
            var initTimeList = $("select[name=initTime]");

            $.ajax({
                url: location.protocol+"//"+window.location.host+"/nodes/"+getSelectedId("node")+"/initTimes",
                accepts: "application/json",
                error: function( jqXHR, textStatus, errorThrown ){
                    showError(jqXHR , textStatus, errorThrown);
                },
                success:  function( data ){
                    initTimeList.empty()
                    for (var i = 0 ; i < data.length ; i++){
                        initTimeList.append('<option value="'+data[i].id+'">'+ $.format.date(data[i].initTime,"dd-MM-yyyy HH:mm:ss")+'</option>');
                    }
                }
            });
        }


        function toggleSelectfields(){
            console.log("appel");
            var $icon = $( "#fi-refresh" ),
            animateClass = "icon-refresh-animate";

            if($icon.hasClass(animateClass)){
                $("#networkSelect").prop('disabled', 'disabled');
                $("#nodeSelect" ).prop('disabled', 'disabled');
                $("#nodeLock" ).addClass("fi-lock");
                $("#networkLock" ).addClass("fi-lock");

            } else{
                $("#networkSelect" ).prop('disabled', false);
                $("#nodeSelect" ).prop('disabled', false);
                $("#nodeLock" ).removeClass();
                $("#networkLock" ).removeClass();

            }
        }

        /* ==============================================================================
                                    Coordinates graphs generation
           ============================================================================== */


        function getCoordinateList(){
            $.ajax({
                url: location.protocol+"//"+window.location.host+"/nodes/"+getSelectedId("node")+"/initTimes/"+getSelectedId("initTime")+"/coordinates",
                accepts: "application/json",
                error: function( jqXHR, textStatus, errorThrown ){
                    showError(jqXHR , textStatus, errorThrown);
                },
                success:  function( data ){
                    handleCoordinate(data);
                }
            });
        }


        function handleCoordinate(data) {

            var dataX = new google.visualization.DataTable();
            var dataY = new google.visualization.DataTable();

            dataX.addColumn('datetime', 'time');
            dataX.addColumn('number', 'X');

            dataY.addColumn('datetime', 'time');
            dataY.addColumn('number', 'Y');

            for (var i = 0 ; i<data.length ; i++){
                var date = new Date();
                date.setTime(data[i].coordinateTime);
                dataX.addRow([date,data[i].x]);
                dataY.addRow([date,data[i].y]);
            }

            var optionsX = {
                title: 'X along time',
                hAxis: {title: 'time'},
                vAxis: {title: 'x'},
                legend: 'none',
                height: 400
            };

            var optionsY = {
                title: 'Y along time',
                hAxis: {title: 'time'},
                vAxis: {title: 'y'},
                legend: 'none',
                height: 400
            };

            var chartX = new google.visualization.ScatterChart(document.getElementById('Xchart_div'));
            chartX.draw(dataX, optionsX);
            var chartY = new google.visualization.ScatterChart(document.getElementById('Ychart_div'));
            chartY.draw(dataY, optionsY);
        }


        /* ==============================================================================
                                    Bubble Graph Generation
           ============================================================================== */


        function getBubblesList(){
            $.ajax({
                url: location.protocol+"//"+window.location.host+"/nodes/"+getSelectedId("node")+"/initTimes/"+getSelectedId("initTime")+"/bubbles",
                accepts: "application/json",
                error: function( jqXHR, textStatus, errorThrown ){
                    showError(jqXHR , textStatus, errorThrown);
                },
                success:  function( data ){
                    handleBubbles(data);
                }
            });
        }

        function handleBubbles(data) {

            var bubbles = new google.visualization.DataTable();

            bubbles.addColumn('string','ID');
            bubbles.addColumn('number','Position');
            bubbles.addColumn('number','Node Id');
            bubbles.addColumn('string','Node Id');
            bubbles.addColumn('number','Number');

            for (var i = 0 ; i<data.length ; i++){
                bubbles.addRow([""+data[i].cardinal,data[i].position,data[i].nodeDistantId,""+data[i].nodeDistantId,data[i].cardinal]);
            }

            var optionsBubbles = {
                title: 'Close Nodes Positions',
                hAxis: {title: 'Position',minValue: -1},
                vAxis: {title: 'Node',minValue: -1},
                height: 1600
            };

            var bubbleChart = new google.visualization.BubbleChart(document.getElementById('bubbleChart_div'));
            bubbleChart.draw(bubbles, optionsBubbles);

        }

        /* ==============================================================================
                                    Cumulated Graph Generation
           ============================================================================== */

        function getCumulatedList(){
            $.ajax({
                url: location.protocol+"//"+window.location.host+"/nodes/"+getSelectedId("node")+"/initTimes/"+getSelectedId("initTime")+"/closeNodesDistanceCumul",
                accepts: "application/json",
                error: function( jqXHR, textStatus, errorThrown ){
                    showError(jqXHR , textStatus, errorThrown);
                },
                success:  function( data ){
                    handleCumulated(data);
                }
            });
        }

        function handleCumulated(data) {

            var cumuls = new google.visualization.DataTable();

            cumuls.addColumn('datetime','Time');
            cumuls.addColumn('number','cumulatedDistance');

            for (var i = 0 ; i<data.length ; i++){
                var date = new Date();
                date.setTime(data[i].time);
                cumuls.addRow([date,data[i].distanceCumul]);
            }

            var optionsCumul = {
                title: 'Close node tables distance cumulated',
                hAxis: {title: 'time'},
                vAxis: {title: 'Cumulated Distance'},
                legend: 'none',
                height: 400
            };

            var cumulChart = new google.visualization.ScatterChart(document.getElementById('cumulChart_div'));
            cumulChart.draw(cumuls, optionsCumul);

        }
        /* ==============================================================================
                                           Triggers
           ============================================================================== */

        function triggerGraphs(){
            getCoordinateList();
            getBubblesList();
            getCumulatedList();
        }

        google.setOnLoadCallback(triggerGraphs);

    </script>

}

